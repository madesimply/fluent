"use strict";var A=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var P=(n,e)=>{for(var t in e)A(n,t,{get:e[t],enumerable:!0})},j=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of w(e))!I.call(n,o)&&o!==t&&A(n,o,{get:()=>e[o],enumerable:!(i=b(e,o))||i.enumerable});return n};var k=n=>j(A({},"__esModule",{value:!0}),n);var q={};P(q,{fluent:()=>g});module.exports=k(q);function p(n){return typeof n=="object"&&n!==null}function y(n){return typeof n=="object"&&n!==null&&"method"in n&&typeof n.method=="string"&&"args"in n&&Array.isArray(n.args)}function x(n){return typeof n=="object"&&n!==null&&"chain"in n&&Array.isArray(n.chain)}function d(n,e,t){if(x(n))return g({api:e,chain:n.chain,ctx:t});if(Array.isArray(n))return n.map(i=>d(i,e,t));if(y(n))return{...n,args:n.args.map(i=>d(i,e,t))};if(typeof n=="object"&&n!==null){let i={};for(let o in n)i[o]=d(n[o],e,t);return i}return n}function S(n){let e=n.args.map(t=>JSON.stringify(t)).join(", ");return`${n.method}(${e})`}function h(n,e,t,i,o){let s={chain:t,run:r=>O(n,r,t,o),goto:r=>{if(!x(r)||r.chain.length===0)throw new Error("Goto must receive a non-empty Fluent");return h(n,e,[...t,...r.chain],i,o)},toString:()=>t.map(S).join(".").replace(/\.$/,"")};return new Proxy(s,{get(r,a){if(a in r)return r[a];let f,u;if(p(e)&&a in e)f=e[a],u=`${i}${i?".":""}${a}`;else if(p(n)&&a in n)f=n[a],u=a;else return;if(typeof f=="function")return(...c)=>{let l=u,T={args:c},C=[...t,{method:l,args:T.args,data:{},return:{}}];return h(n,e,C,i,o)};if(p(f))return h(n,f,t,u,o)}})}function F(n,e={}){let t={};for(let i in n)typeof n[i]=="function"?t[i]=n[i].bind(e):typeof n[i]=="object"&&n[i]!==null?t[i]=F(n[i],e):t[i]=n[i];return t}function $(n,e,t){if(!t)return[];let i;return typeof t=="string"?i=new Function("api","fluent",`
      const root = fluent({ api });
      const { ${Object.keys(n).join(",")} } = root;
      const chain = ${t};
      return chain.chain;
    `)(n,g):i=t,i.map(o=>y(o)?{...o,args:o.args.map(s=>d(s,n,e))}:o)}var R=()=>typeof m=="function"?m:typeof globalThis<"u"&&typeof globalThis.setImmediate=="function"?globalThis.setImmediate:(n,...e)=>setTimeout(n,0,...e),m=R();function O(n,e,t,i){let o=e,s=0,r=!1;function a(){if(s>=t.length)return o;let u=t[s];if(y(u)){let c=u.method.split(".").reduce((T,C)=>T[C],n);if(typeof c!="function")throw new Error(`Method ${u.method} not found in API`);let l=c(o,...u.args);if(l instanceof Promise)return l.then(T=>E(n,T,t.slice(s+1),i));o=l===void 0?o:l}return s++,a()}let f=a();return r?new Promise(u=>m(()=>u(f))):f}async function E(n,e,t,i){let o=e,s=0;for(;s<t.length;){let r=t[s];if(y(r)){let a=r.method.split(".").reduce((u,c)=>u[c],n);if(typeof a!="function")throw new Error(`Method ${r.method} not found in API`);let f=await a(o,...r.args);o=f===void 0?o:f}s++}return o}function g(n){let{api:e,ctx:t,chain:i}=n,o=F(e,t),s=$(o,t||{},i),r=t?.fluent||{blocking:!1};return h(o,o,s,"",r)}0&&(module.exports={fluent});
//# sourceMappingURL=index.cjs.map
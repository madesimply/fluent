var C=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var P=(n,t)=>{for(var r in t)C(n,r,{get:t[r],enumerable:!0})},O=(n,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of S(t))!j.call(n,o)&&o!==r&&C(n,o,{get:()=>t[o],enumerable:!(e=R(t,o))||e.enumerable});return n};var w=n=>O(C({},"__esModule",{value:!0}),n);var N={};P(N,{fluent:()=>p,initChain:()=>x});module.exports=w(N);function T(n,t,r){let{method:e,args:o}=r;return e.split(".").reduce((c,u)=>c[u],n)(t,...o||[])}async function F(n,t,r,e){await r,t=r===void 0?t:r;for(let o of e){let i=T(n,t,o);i instanceof Promise&&await i,t=i===void 0?t:i}return t}function I(n,t,r){let e=n.slice(r+1),o=JSON.stringify(t),i=e.findIndex(s=>JSON.stringify(s)===o);return i>-1?i:n.slice(0,r+1).findIndex(({goto:s,...f})=>JSON.stringify(f)===o)}function m(n,t,r,e){let o=[...t],i=(u,s=0)=>{var y;let f=-1;for(let a=s;a<o.length;a++){let l=o[a];if(l.goto&&l.goto.args){let d=I(o,l.goto.args[0],a);d>-1&&(f=d)}let g=T(n,u,l);if(g instanceof Promise){let d=o.slice(o.indexOf(l)+1);return F(n,u,g,d)}u=g===void 0?u:g,f>-1}if(f>-1){if((y=e==null?void 0:e.fluent)!=null&&y.blocking)return i(u,f);setTimeout(()=>i(u,f),0)}return u},c={get(u,s){if(s==="run")return i;if(s==="toJSON")return()=>o;if(s==="goto")return g=>{let d={method:"goto",args:JSON.parse(JSON.stringify(g))};return o[o.length-1].goto=d,m(n,[...o],r,e)};if(s==="toString")return()=>J(o);if(typeof s!="string")return;let y=(s in n?n[s]:void 0)?[s]:[...r,s],a=y.join("."),l=y.reduce((g,d)=>g[d],n);if(typeof l=="object"&&l!==null)return m(n,o,y,e);if(typeof l=="function")return l.length<=1?m(n,[...o,{method:a}],r,e):(...d)=>m(n,[...o,{method:a,args:d}],r,e)}};return new Proxy(()=>{},c)}function A(n,t){let r={};for(let e in n)typeof n[e]=="function"?r[e]=n[e].bind(t):typeof n[e]=="object"&&n[e]!==null?r[e]=A(n[e],t):r[e]=n[e];return r}function x(n,t,r){return n.map(e=>(e.args&&(e.args=e.args.map(o=>h(o,t,r))),e))}function h(n,t,r){let e=Array.isArray(n),o=!e&&typeof n=="object"&&n!==null;if(e)return n.every(i=>"method"in i)?p({api:t,chain:n,ctx:r}):n.map(i=>h(i,t,r));if(o){for(let i in n)n[i]=h(n[i],t,r);return n}return n}function b(n,t){let[r,...e]=n.split("("),i=e.join("(").replace(/\)$/,"").split(",").map(c=>c.split("(")[0].trim().split(".").reduce((f,y)=>f&&f[y],t)?b(c.trim(),t):c.trim());return[{method:r,args:i}]}function J(n){return n.map(t=>{var e;let r=(e=t.args)!=null&&e.length?`(${t.args.join(", ")})`:"";return`${t.method}${r}`}).join(".")}function p({api:n,chain:t=[],ctx:r}){let e=A(n,r||{}),o=typeof t=="string"?b(t,e):t,i=o.length?o.slice(-1)[0].method.split(".").slice(0,-1):[],c=t?x(o,e,r):[];return m(e,c,i,r||{})}0&&(module.exports={fluent,initChain});
//# sourceMappingURL=index.cjs.map
var m=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var O=(n,e)=>{for(var i in e)m(n,i,{get:e[i],enumerable:!0})},F=(n,e,i,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of P(e))!S.call(n,r)&&r!==i&&m(n,r,{get:()=>e[r],enumerable:!(t=j(e,r))||t.enumerable});return n};var I=n=>F(m({},"__esModule",{value:!0}),n);var q={};O(q,{fluent:()=>R,initChain:()=>b});module.exports=I(q);function A(n,e,i){let{method:t,args:r}=i;return t.split(".").reduce((f,l)=>f[l],n)(e,...r||[])}async function J(n,e,i,t){await i,e=i===void 0?e:i;for(let r of t){let o=A(n,e,r);o instanceof Promise&&await o,e=o===void 0?e:o}return e}function N(n,e,i){let t=n.slice(i+1),r=JSON.stringify(e),o=t.findIndex(s=>JSON.stringify(s)===r);return o>-1?o:n.slice(0,i+1).findIndex(({goto:s,...u})=>JSON.stringify(u)===r)}function a(n,e,i,t){let r=[...e],o=(l,s=0)=>{var h;let u=-1;for(let y=s;y<r.length;y++){let c=r[y];if(c.goto&&c.goto.args){let g=N(r,c.goto.args[0],y);g>-1&&(u=g)}let d=A(n,l,c);if(d instanceof Promise){let g=r.slice(r.indexOf(c)+1);return J(n,l,d,g)}l=d===void 0?l:d,u>-1}if(u>-1){if((h=t==null?void 0:t.fluent)!=null&&h.blocking)return o(l,u);setTimeout(()=>o(l,u),0)}return l},f={get(l,s){if(s==="run")return o;if(s==="toJSON")return()=>r;if(s==="goto")return d=>{let g={method:"goto",args:JSON.parse(JSON.stringify(d))};return r[r.length-1].goto=g,a(n,[...r],i,t)};if(s==="toString")return()=>w(r);if(typeof s!="string")return;let h=(s in n?n[s]:void 0)?[s]:[...i,s],y=h.join("."),c=h.reduce((d,g)=>d[g],n);if(typeof c=="object"&&c!==null)return a(n,r,h,t);if(typeof c=="function")return c.length<=1?a(n,[...r,{method:y}],i,t):(...g)=>a(n,[...r,{method:y,args:g}],i,t)}};return new Proxy(()=>{},f)}function x(n,e){let i={};for(let t in n)typeof n[t]=="function"?i[t]=n[t].bind(e):typeof n[t]=="object"&&n[t]!==null?i[t]=x(n[t],e):i[t]=n[t];return i}function b(n,e,i){return n.map(t=>(t.args&&(t.args=t.args.map(r=>C(r,e,i))),t))}function C(n,e,i){let t=Array.isArray(n),r=!t&&typeof n=="object"&&n!==null;if(t)return n.every(o=>"method"in o)?R({api:e,chain:n,ctx:i}):n.map(o=>C(o,e,i));if(r){for(let o in n)n[o]=C(n[o],e,i);return n}return n}function p(n,e){let i=[],t=[],r=[],o=!1,f="";function l(s,u){return s in u}for(let s=0;s<n.length;s++){let u=n[s];if(u==="."&&!o)f&&l(f,e)&&(i.push({method:t.join(".")+"."+f,args:r.length?T(r,e):[]}),f="",r=[]),t=[];else if(u==="(")o=!0,f&&r.push("");else if(u===")")o=!1;else if(u===","&&!o)f&&r.push("");else{if(u===" ")continue;o?r.length>0?r[r.length-1]+=u:r.push(u):f===""?f+=u:(t.length>0||f)&&t.push(u)}}return f&&l(f,e)&&i.push({method:t.join(".")+"."+f,args:r.length?T(r,e):[]}),i}function T(n,e){return n.map(i=>(i=i.replace(/^['"]|['"]$/g,""),/^\w+\(/.test(i)?p(i,e):i))}function w(n){return n.map(e=>{var t;let i=(t=e.args)!=null&&t.length?`(${e.args.join(", ")})`:"";return`${e.method}${i}`}).join(".")}function R({api:n,chain:e=[],ctx:i}){let t=x(n,i||{}),r=typeof e=="string"?p(e,t):e,o=r.length?r.slice(-1)[0].method.split(".").slice(0,-1):[],f=e?b(r,t,i):[];return a(t,f,o,i||{})}0&&(module.exports={fluent,initChain});
//# sourceMappingURL=index.cjs.map
var h=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var P=(n,t)=>{for(var o in t)h(n,o,{get:t[o],enumerable:!0})},S=(n,t,o,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of p(t))!j.call(n,r)&&r!==o&&h(n,r,{get:()=>t[r],enumerable:!(e=R(t,r))||e.enumerable});return n};var O=n=>S(h({},"__esModule",{value:!0}),n);var J={};P(J,{fluent:()=>b,initChain:()=>A});module.exports=O(J);function T(n,t,o){let{method:e,args:r}=o;return e.split(".").reduce((g,s)=>g[s],n)(t,...r||[])}async function I(n,t,o,e){t=await o;for(let r of e){let i=T(n,t,r);i instanceof Promise&&await i,t=i===void 0?t:i}return t}function N(n,t,o){let e=n.slice(o+1),r=JSON.stringify(t),i=e.findIndex(u=>JSON.stringify(u)===r);return i>-1?i:n.slice(0,o+1).findIndex(({goto:u,...f})=>JSON.stringify(f)===r)}function m(n,t=[],o=[],e){let r=[...t],i=(s,u=0)=>{var a;let f=-1;for(let y=u;y<r.length;y++){let c=r[y];if(c.goto&&c.goto.args){let l=N(r,c.goto.args[0],y);l>-1&&(f=l)}let d=T(n,s,c);if(d instanceof Promise){let l=r.slice(r.indexOf(c)+1);return I(n,s,d,l)}s=d===void 0?s:d,f>-1}if(f>-1){if((a=e==null?void 0:e.fluent)!=null&&a.blocking)return i(s,f);setTimeout(()=>i(s,f),0)}return s},g={get(s,u){if(u==="run")return i;if(u==="toJSON")return()=>r;if(u==="goto")return d=>{let l={method:"goto",args:JSON.parse(JSON.stringify(d))};return r[r.length-1].goto=l,m(n,[...r],o,e)};if(u==="toString")return()=>F(r);if(typeof u!="string")return;let a=(u in n?n[u]:void 0)?[u]:[...o,u],y=a.join("."),c=a.reduce((d,l)=>d[l],n);if(typeof c=="object"&&c!==null)return m(n,r,a,e);if(typeof c=="function")return c.length<=1?m(n,[...r,{method:y}],o,e):(...l)=>m(n,[...r,{method:y,args:l}],o,e)}};return new Proxy(()=>{},g)}function x(n,t){let o={};for(let e in n)typeof n[e]=="function"?o[e]=n[e].bind(t):typeof n[e]=="object"&&n[e]!==null?o[e]=x(n[e],t):o[e]=n[e];return o}function A(n,t,o){return n.map(e=>(e.args&&(e.args=e.args.map(r=>C(r,t,o))),e))}function C(n,t,o){let e=Array.isArray(n),r=!e&&typeof n=="object"&&n!==null;if(e)return n.every(i=>"method"in i)?b({api:t,chain:n,ctx:o}):n.map(i=>C(i,t,o));if(r){for(let i in n)n[i]=C(n[i],t,o);return n}return n}function w(n,t){let o=/(\w+)(?:\(([^)]*)\))?/g,e=[],r=t,i=[];for(;;){let g=o.exec(n);if(!g)break;let[,s,u]=g;if(!r[s]&&t[s]&&(r=t,i=[]),typeof r[s]=="function"){let f=i.length?`${i.join(".")}.${s}`:s;e.push({method:f,args:u?u.split(",").map(a=>a.trim()):[]})}else typeof r[s]=="object"&&(r=r[s],i.push(s));n.slice(o.lastIndex).trim().startsWith(".")||(r=t,i=[])}return e}function F(n){return n.map(t=>{var e;let o=(e=t.args)!=null&&e.length?`(${t.args.join(", ")})`:"";return`${t.method}${o}`}).join(".")}function b({api:n,chain:t=[],ctx:o}){let e=x(n,o||{}),r=typeof t=="string"?w(t,e):t,i=r.length?r.slice(-1)[0].method.split(".").slice(0,-1):[],g=t?A(r,e,o):[];return m(e,g,i,o||{})}0&&(module.exports={fluent,initChain});
//# sourceMappingURL=index.cjs.map
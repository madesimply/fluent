var C=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var F=(n,e)=>{for(var r in e)C(n,r,{get:e[r],enumerable:!0})},I=(n,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of P(e))!O.call(n,o)&&o!==r&&C(n,o,{get:()=>e[o],enumerable:!(t=R(e,o))||t.enumerable});return n};var J=n=>I(C({},"__esModule",{value:!0}),n);var j={};F(j,{fluent:()=>b,initChain:()=>h});module.exports=J(j);function x(n,e,r){let{method:t,args:o}=r;return t.split(".").reduce((m,u)=>m[u],n)(e,...o||[])}async function N(n,e,r,t){e=await r;for(let o of t){let i=x(n,e,o);i instanceof Promise&&await i,e=i}return e}function S(n,e,r){let t=n.slice(r+1),o=JSON.stringify(e),i=t.findIndex(s=>JSON.stringify(s)===o);return i>-1?i:n.slice(0,r+1).findIndex(({goto:s,...l})=>JSON.stringify(l)===o)}function a(n,e=[],r=[],t){let o=[...e],i=(u,s=0)=>{let l=-1;for(let c=s;c<o.length;c++){let d=o[c];if(d.goto&&d.goto.args){let f=S(o,d.goto.args[0],c);f>-1&&(l=f)}let y=x(n,u,d);if(y instanceof Promise){let f=o.slice(o.indexOf(d)+1);return N(n,u,y,f)}u=y,l>-1}if(l>-1){if(t.blocking)return i(u,l);setTimeout(()=>i(u,l),0)}return u},m={get(u,s){if(s==="run")return i;if(s==="toJSON")return()=>o;if(s==="goto")return f=>{let g={method:"goto",args:JSON.parse(JSON.stringify(f))};return o[o.length-1].goto=g,a(n,[...o],r,t)};if(typeof s!="string")return;let c=(s in n?n[s]:void 0)?[s]:[...r,s],d=c.join("."),y=c.reduce((f,g)=>f[g],n);if(typeof y=="object"&&y!==null)return a(n,o,c,t);if(typeof y=="function")return y.length<=1?a(n,[...o,{method:d}],r,t):(...g)=>a(n,[...o,{method:d,args:g}],r,t)}};return new Proxy(()=>{},m)}function A(n,e){let r={};for(let t in n)typeof n[t]=="function"?r[t]=n[t].bind(e):typeof n[t]=="object"&&n[t]!==null?r[t]=A(n[t],e):r[t]=n[t];return r}function h(n,e,r){return n.map(t=>(t.args&&(t.args=t.args.map(o=>T(o,e,r))),t))}function T(n,e,r){let t=Array.isArray(n),o=!t&&typeof n=="object"&&n!==null;if(t)return n.every(i=>"method"in i)?b({api:e,chain:n,ctx:r}):n.map(i=>T(i,e,r));if(o){for(let i in n)n[i]=T(n[i],e,r);return n}return n}function b({api:n,chain:e=[],ctx:r}){let t=e.length?e.slice(-1)[0].method.split(".").slice(0,-1):[],o=A(n,r||{}),i=e?h(e,n,r):[];return a(o,i,t,r||{})}0&&(module.exports={fluent,initChain});
//# sourceMappingURL=index.cjs.map
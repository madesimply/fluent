var h=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var S=(n,e)=>{for(var o in e)h(n,o,{get:e[o],enumerable:!0})},O=(n,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of j(e))!P.call(n,r)&&r!==o&&h(n,r,{get:()=>e[r],enumerable:!(t=R(e,r))||t.enumerable});return n};var I=n=>O(h({},"__esModule",{value:!0}),n);var $={};S($,{fluent:()=>p,initChain:()=>x});module.exports=I($);function T(n,e,o){let{method:t,args:r}=o;return t.split(".").reduce((g,s)=>g[s],n)(e,...r||[])}async function N(n,e,o,t){await o,e=o===void 0?e:o;for(let r of t){let i=T(n,e,r);i instanceof Promise&&await i,e=i===void 0?e:i}return e}function w(n,e,o){let t=n.slice(o+1),r=JSON.stringify(e),i=t.findIndex(u=>JSON.stringify(u)===r);return i>-1?i:n.slice(0,o+1).findIndex(({goto:u,...f})=>JSON.stringify(f)===r)}function m(n,e,o,t){let r=[...e],i=(s,u=0)=>{var d;let f=-1;for(let y=u;y<r.length;y++){let c=r[y];if(c.goto&&c.goto.args){let l=w(r,c.goto.args[0],y);l>-1&&(f=l)}let a=T(n,s,c);if(a instanceof Promise){let l=r.slice(r.indexOf(c)+1);return N(n,s,a,l)}s=a===void 0?s:a,f>-1}if(f>-1){if((d=t==null?void 0:t.fluent)!=null&&d.blocking)return i(s,f);setTimeout(()=>i(s,f),0)}return s},g={get(s,u){if(u==="run")return i;if(u==="toJSON")return()=>r;if(u==="goto")return a=>{let l={method:"goto",args:JSON.parse(JSON.stringify(a))};return r[r.length-1].goto=l,m(n,[...r],o,t)};if(u==="toString")return()=>J(r);if(typeof u!="string")return;let d=(u in n?n[u]:void 0)?[u]:[...o,u],y=d.join("."),c=d.reduce((a,l)=>a[l],n);if(typeof c=="object"&&c!==null)return m(n,r,d,t);if(typeof c=="function")return c.length<=1?m(n,[...r,{method:y}],o,t):(...l)=>m(n,[...r,{method:y,args:l}],o,t)}};return new Proxy(()=>{},g)}function A(n,e){let o={};for(let t in n)typeof n[t]=="function"?o[t]=n[t].bind(e):typeof n[t]=="object"&&n[t]!==null?o[t]=A(n[t],e):o[t]=n[t];return o}function x(n,e,o){return n.map(t=>(t.args&&(t.args=t.args.map(r=>C(r,e,o))),t))}function C(n,e,o){let t=Array.isArray(n),r=!t&&typeof n=="object"&&n!==null;if(t)return n.every(i=>"method"in i)?p({api:e,chain:n,ctx:o}):n.map(i=>C(i,e,o));if(r){for(let i in n)n[i]=C(n[i],e,o);return n}return n}function b(n,e){let o=/(\w+)(?:\(([^)]*)\))?/g,t=[],r=e,i=[];for(;;){let g=o.exec(n);if(!g)break;let[,s,u]=g;if(!r[s]&&e[s]&&(r=e,i=[]),typeof r[s]=="function"){let f=i.length?`${i.join(".")}.${s}`:s;console.log(u);let d=u?u.split(",").map(y=>F(y.trim(),e)):[];console.log(d),t.push({method:f,args:d})}else typeof r[s]=="object"&&(r=r[s],i.push(s));n.slice(o.lastIndex).trim().startsWith(".")||(r=e,i=[])}return t}function F(n,e){return/^['"].*['"]$/.test(n)?n:b(n,e)}function J(n){return n.map(e=>{var t;let o=(t=e.args)!=null&&t.length?`(${e.args.join(", ")})`:"";return`${e.method}${o}`}).join(".")}function p({api:n,chain:e=[],ctx:o}){let t=A(n,o||{}),r=typeof e=="string"?b(e,t):e,i=r.length?r.slice(-1)[0].method.split(".").slice(0,-1):[],g=e?x(r,t,o):[];return m(t,g,i,o||{})}0&&(module.exports={fluent,initChain});
//# sourceMappingURL=index.cjs.map